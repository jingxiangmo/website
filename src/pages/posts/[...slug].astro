---
import { getCollection, type CollectionEntry } from "astro:content";
import Layout from "@/layouts/Layout.astro";
import { ViewTransitions } from "astro:transitions";
import Contact from "@/components/shared/Contact.astro";

export const prerender = true;

export async function getStaticPaths() {
  const postEntries = await getCollection("posts");
  return postEntries.map((entry) => ({
    params: { slug: entry.slug },
    props: { entry },
  }));
}

type Props = {
  entry: CollectionEntry<"posts">;
};

const { entry } = Astro.props;
const { Content } = await entry.render();
---

<Layout title={entry.data.title}>
  <ViewTransitions />
  <div class="post max-w-3xl">

    <h1>{entry.data.title}</h1>

    <div>
      Published on {(entry.data.date as Date).toLocaleDateString()} by {
        entry.data.author
      }
    </div>

    {
      entry.data.isDraft && (
        <div>Work in progress.</div>
      )
    }
    <div class="py-2"></div>

    <Content />

    <div class="py-6"></div>

    <Contact />

    <div class="py-2"></div>

    <script src="https://giscus.app/client.js"
            data-repo="jingxiangmo/website"
            data-repo-id="R_kgDOH_dhCA"
            data-category="Blog Post Comments"
            data-category-id="DIC_kwDOH_dhCM4CcnsZ"
            data-mapping="url"
            data-strict="0"
            data-reactions-enabled="1"
            data-emit-metadata="0"
            data-input-position="top"
            data-theme="preferred_color_scheme"
            data-lang="en"
            data-loading="lazy"
            crossorigin="anonymous"
            async>
    </script>

    <div class="py-2"></div>

  </div>
</Layout>
